<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Наша недвижимость - система управления арендой</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #6c757d;
            --accent: #ff6b6b;
            --success: #4cc9a4;
            --warning: #ffd166;
            --danger: #ef476f;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #8d99ae;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            --sidebar-width: 260px;
            --header-height: 70px;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary: #5e72e4;
            --primary-dark: #4d5fd0;
            --secondary: #9ba7b5;
            --light: #2d3748;
            --dark: #f8f9fa;
            --gray: #718096;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--light);
            box-shadow: var(--card-shadow);
            padding: 1.5rem 1rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: var(--transition);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2rem;
            padding: 0 0.5rem;
        }

        .sidebar-header .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .sidebar-header i {
            font-size: 1.8rem;
            color: var(--primary);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1rem;
            color: var(--secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--primary);
            color: white;
        }

        .sidebar-menu i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: var(--light);
            border: none;
            width: 50px;
            height: 26px;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 3px;
        }

        .theme-toggle span {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            position: absolute;
            transition: var(--transition);
        }

        .dark-mode .theme-toggle span {
            transform: translateX(24px);
        }

        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .stat-label {
            color: var(--secondary);
            font-weight: 50%;
        }

        .recent-activity {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .activity-list {
            list-style: none;
            margin-top: 1rem;
        }

        .activity-list li {
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .activity-list li:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* Form Styles */
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .form-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #3da58a;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .data-table th, .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--secondary);
        }

        .data-table tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-free {
            background: rgba(76, 201, 164, 0.2);
            color: var(--success);
        }

        .status-occupied {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
        }

        .status-maintenance {
            background: rgba(255, 209, 102, 0.2);
            color: var(--warning);
        }

        .payment-status-paid {
            background: rgba(76, 201, 164, 0.2);
            color: var(--success);
        }

        .payment-status-pending {
            background: rgba(255, 209, 102, 0.2);
            color: var(--warning);
        }

        .payment-status-overdue {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem;
            border-radius: 6px;
            cursor: pointer;
            color: var(--secondary);
            transition: var(--transition);
        }

        .action-btn:hover {
            background: var(--light);
            color: var(--primary);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Tenant Info Styles */
        .tenant-info {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tenant-info h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .tenant-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .tenant-detail {
            display: flex;
            flex-direction: column;
        }

        .tenant-detail label {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .tenant-detail span {
            color: var(--dark);
        }

        /* Payment History Styles */
        .payment-history {
            margin-top: 1.5rem;
        }

        .payment-history h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        /* Map Styles */
        #map-container {
            height: 500px;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 1.5rem 0;
            box-shadow: var(--card-shadow);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .user-actions {
                width: 100%;
                justify-content: space-between;
            }

            .report-actions {
                flex-direction: column;
            }

            #map-container {
                height: 300px;
            }

            .tenant-details {
                grid-template-columns: 1fr;
            }
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary);
        }

        @media (max-width: 992px) {
            .menu-toggle {
                display: block;
            }
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .dark-mode .stat-card,
        .dark-mode .recent-activity,
        .dark-mode .form-section,
        .dark-mode .modal,
        .dark-mode .tenant-info {
            background: var(--light);
            color: var(--dark);
        }

        .dark-mode .data-table th {
            background: #374151;
            color: var(--dark);
        }

        .dark-mode .data-table tr:hover {
            background: #374151;
        }

        .dark-mode .activity-icon {
            background: #374151;
        }

        .dark-mode .header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            background: var(--success);
            color: white;
            box-shadow: var(--card-shadow);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: var(--danger);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-building"></i>
                <div class="logo">Наша недвижимость</div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-th-large"></i> Дашборд</a></li>
                <li><a href="#" class="nav-link" data-page="properties"><i class="fas fa-building"></i> Объекты</a></li>
                <li><a href="#" class="nav-link" data-page="tenants"><i class="fas fa-users"></i> Арендаторы</a></li>
                <li><a href="#" class="nav-link" data-page="contracts"><i class="fas fa-file-contract"></i> Договоры</a></li>
                <li><a href="#" class="nav-link" data-page="map"><i class="fas fa-map-marker-alt"></i> Карта</a></li>
                <li><a href="#" class="nav-link" data-page="documents"><i class="fas fa-file-alt"></i> Документы</a></li>
                <li><a href="#" class="nav-link" data-page="settings"><i class="fas fa-cog"></i> Настройки</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 class="page-title">Дашборд</h1>
                <div class="user-actions">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="theme-toggle" id="themeToggle">
                        <span></span>
                    </button>
                    <div class="user-profile">
                        <img src="https://ui-avatars.com/api/?name=Admin+User&background=4361ee&color=fff" alt="User" style="width: 40px; height: 40px; border-radius: 50%;">
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <div class="report-actions">
                    <button class="btn btn-success" id="exportDashboardPdf">
                        <i class="fas fa-file-pdf"></i> Экспорт отчета в PDF
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(67, 97, 238, 0.1); color: var(--primary);">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="stat-value">154</div>
                        <div class="stat-label">Всего объектов</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(76, 201, 164, 0.1); color: var(--success);">
                            <i class="fas fa-key"></i>
                        </div>
                        <div class="stat-value">42</div>
                        <div class="stat-label">Свободно</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(239, 71, 111, 0.1); color: var(--danger);">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="stat-value">87</div>
                        <div class="stat-label">Арендовано</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 209, 102, 0.1); color: var(--warning);">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-value">25</div>
                        <div class="stat-label">На обслуживании</div>
                    </div>
                </div>

                <div class="recent-activity">
                    <h2>Последняя активность</h2>
                    <ul class="activity-list">
                        <li>
                            <div class="activity-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div>
                                <div>Добавлен новый объект: БЦ "Солнечный"</div>
                                <small>Сегодня, 10:24</small>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div>
                                <div>Заключен новый договор аренды с ООО "ТехноПром"</div>
                                <small>Вчера, 15:47</small>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div>
                                <div>Запланирован ремонт в офисе 345, БЦ "Высоцкий"</div>
                                <small>23 мая, 09:12</small>
                            </div>
                        </li>
                        <li>
                            <div class="activity-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div>
                                <div>Заканчивается срок аренды у ООО "Вектор" через 7 дней</div>
                                <small>22 мая, 16:30</small>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Properties Page -->
            <div class="page" id="properties">
                <div class="form-section">
                    <h2 class="form-title">Добавить новый объект</h2>
                    <form id="propertyForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="propertyName">Название объекта</label>
                                <input type="text" id="propertyName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="propertyAddress">Адрес</label>
                                <input type="text" id="propertyAddress" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="propertyType">Тип объекта</label>
                                <select id="propertyType" class="form-control" required>
                                    <option value="">Выберите тип</option>
                                    <option value="office">Офисное помещение</option>
                                    <option value="retail">Торговая площадь</option>
                                    <option value="warehouse">Складское помещение</option>
                                    <option value="industrial">Производственное помещение</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="propertyArea">Площадь (кв. м)</label>
                                <input type="number" id="propertyArea" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="propertyStatus">Статус</label>
                                <select id="propertyStatus" class="form-control" required>
                                    <option value="free">Свободен</option>
                                    <option value="occupied">Занят</option>
                                    <option value="maintenance">На обслуживании</option>
                                    <option value="reserved">Резерв</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="propertyPrice">Стоимость аренды (руб./мес.)</label>
                                <input type="number" id="propertyPrice" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="propertyDescription">Описание</label>
                            <textarea id="propertyDescription" class="form-control" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Добавить объект
                        </button>
                    </form>
                </div>

                <div class="form-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 class="form-title">Список объектов</h2>
                        <button class="btn btn-success" id="exportPropertiesExcel">
                            <i class="fas fa-file-excel"></i> Экспорт в Excel
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Название</th>
                                    <th>Адрес</th>
                                    <th>Тип</th>
                                    <th>Площадь</th>
                                    <th>Статус</th>
                                    <th>Стоимость</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="propertiesTableBody">
                                <!-- Properties will be added here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tenants Page -->
            <div class="page" id="tenants">
                <div class="form-section">
                    <h2 class="form-title">Добавить арендатора</h2>
                    <form id="tenantForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tenantName">Название организации</label>
                                <input type="text" id="tenantName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="tenantContact">Контактное лицо</label>
                                <input type="text" id="tenantContact" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="tenantPhone">Телефон</label>
                                <input type="tel" id="tenantPhone" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="tenantEmail">Email</label>
                                <input type="email" id="tenantEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="tenantINN">ИНН</label>
                                <input type="text" id="tenantINN" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="tenantContract">Номер договора</label>
                                <input type="text" id="tenantContract" class="form-control" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Добавить арендатора
                        </button>
                    </form>
                </div>

                <div class="form-section">
                    <h2 class="form-title">Список арендаторов</h2>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Организация</th>
                                    <th>Контактное лицо</th>
                                    <th>Телефон</th>
                                    <th>Email</th>
                                    <th>Договор</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="tenantsTableBody">
                                <!-- Tenants will be added here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Contracts Page -->
            <div class="page" id="contracts">
                <div class="form-section">
                    <h2 class="form-title">Договоры аренды</h2>
                    <div class="report-actions">
                        <button class="btn btn-primary" id="addContractBtn">
                            <i class="fas fa-plus"></i> Добавить договор
                        </button>
                        <button class="btn btn-success" id="exportContractsPdf">
                            <i class="fas fa-file-pdf"></i> Экспорт списка договоров
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Номер договора</th>
                                    <th>Объект аренды</th>
                                    <th>Арендатор</th>
                                    <th>Дата начала</th>
                                    <th>Дата окончания</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>А-2023-0451</td>
                                    <td>БЦ "Высоцкий", оф. 345</td>
                                    <td>ООО "ТехноПром"</td>
                                    <td>01.02.2023</td>
                                    <td>31.01.2024</td>
                                    <td><span class="status-badge status-occupied">Действует</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-contract" data-id="1"></i>
                                        <i class="fas fa-edit action-btn edit-contract" data-id="1"></i>
                                        <i class="fas fa-file-excel action-btn export-contract" data-id="1"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>А-2023-0789</td>
                                    <td>ТЦ "Солнечный", пав. 12</td>
                                    <td>ЗАО "Вектор"</td>
                                    <td>15.03.2023</td>
                                    <td>14.03.2024</td>
                                    <td><span class="status-badge status-occupied">Действует</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-contract" data-id="2"></i>
                                        <i class="fas fa-edit action-btn edit-contract" data-id="2"></i>
                                        <i class="fas fa-file-excel action-btn export-contract" data-id="2"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>А-2022-1256</td>
                                    <td>Складской комплекс №3</td>
                                    <td>ИП Смирнов А.В.</td>
                                    <td>01.06.2022</td>
                                    <td>31.05.2023</td>
                                    <td><span class="status-badge status-free">Завершен</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-contract" data-id="3"></i>
                                        <i class="fas fa-edit action-btn edit-contract" data-id="3"></i>
                                        <i class="fas fa-file-excel action-btn export-contract" data-id="3"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Map Page -->
            <div class="page" id="map">
                <div class="form-section">
                    <h2 class="form-title">Интерактивная карта объектов</h2>
                    <p>На карте отображены все объекты недвижимости с цветовой индикацией их статуса:</p>
                    <ul style="margin: 1rem 0 1rem 2rem;">
                        <li><span style="color: #4cc9a4;">Зеленый</span> - объект свободен</li>
                        <li><span style="color: #ef476f;">Красный</span> - объект арендован</li>
                        <li><span style="color: #ffd166;">Желтый</span> - объект на обслуживании</li>
                    </ul>
                    <div id="map-container"></div>
                </div>
            </div>

            <!-- Documents Page -->
            <div class="page" id="documents">
                <div class="form-section">
                    <h2 class="form-title">Документооборот</h2>
                    <div class="report-actions">
                        <button class="btn btn-primary" id="uploadDocumentBtn">
                            <i class="fas fa-upload"></i> Загрузить документ
                        </button>
                        <button class="btn btn-success" id="searchDocumentsBtn">
                            <i class="fas fa-search"></i> Поиск документов
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Название документа</th>
                                    <th>Тип</th>
                                    <th>Объект</th>
                                    <th>Дата добавления</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Договор аренды А-2023-0451</td>
                                    <td>Договор</td>
                                    <td>БЦ "Высоцкий"</td>
                                    <td>25.01.2023</td>
                                    <td><span class="status-badge status-occupied">Действует</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-document" data-id="1"></i>
                                        <i class="fas fa-download action-btn download-document" data-id="1"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Технический паспорт БЦ "Высоцкий"</td>
                                    <td>Техническая документация</td>
                                    <td>БЦ "Высоцкий"</td>
                                    <td>12.12.2022</td>
                                    <td><span class="status-badge status-occupied">Актуальный</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-document" data-id="2"></i>
                                        <i class="fas fa-download action-btn download-document" data-id="2"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Акт приема-передачи ТЦ "Солнечный"</td>
                                    <td>Акт</td>
                                    <td>ТЦ "Солнечный"</td>
                                    <td>14.03.2023</td>
                                    <td><span class="status-badge status-occupied">Подписан</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-document" data-id="3"></i>
                                        <i class="fas fa-download action-btn download-document" data-id="3"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Кадастровый паспорт участка №45-78</td>
                                    <td>Кадастровый документ</td>
                                    <td>Земельный участок "Южный"</td>
                                    <td>05.04.2023</td>
                                    <td><span class="status-badge status-occupied">Актуальный</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-document" data-id="4"></i>
                                        <i class="fas fa-download action-btn download-document" data-id="4"></i>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Отчет об оцене БЦ "Северный"</td>
                                    <td>Отчет</td>
                                    <td>БЦ "Северный"</td>
                                    <td>18.02.2023</td>
                                    <td><span class="status-badge status-occupied">Актуальный</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-document" data-id="5"></i>
                                        <i class="fas fa-download action-btn download-document" data-id="5"></i>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page" id="settings">
                <div class="form-section">
                    <h2 class="form-title">Настройки системы</h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="systemName">Название системы</label>
                            <input type="text" id="systemName" class="form-control" value="Наша недвижимость">
                        </div>
                        <div class="form-group">
                                    <div class="form-group">
                                        <label for="adminEmail">Email администратора</label>
                                        <input type="email" id="adminEmail" class="form-control" value="admin@nasha-realty.ru">
                                    </div>
                                    <div class="form-group">
                                        <label for="backupFrequency">Частота резервного копирования</label>
                                        <select id="backupFrequency" class="form-control">
                                            <option value="daily">Ежедневно</option>
                                            <option value="weekly" selected>Еженедельно</option>
                                            <option value="monthly">Ежемесячно</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="language">Язык интерфейса</label>
                                        <select id="language" class="form-control">
                                            <option value="ru" selected>Русский</option>
                                            <option value="en">Английский</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <h3 style="margin: 2rem 0 1rem 0; color: var(--primary);">Уведомления</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="notifyNewContracts" checked> Уведомлять о новых договорах
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="notifyContractEnd" checked> Уведомлять об окончании срока аренды
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="notifyPropertyIssues" checked> Уведомлять о проблемах с объектами
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="notifyFreeProperties"> Уведомлять о свободных объектах
                                        </label>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" id="saveSettings" style="margin-top: 1.5rem;">
                                    <i class="fas fa-save"></i> Сохранить настройки
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal for editing property -->
                <div class="modal-overlay" id="editPropertyModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">Редактировать объект</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="editPropertyForm">
                                <input type="hidden" id="editPropertyId">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="editPropertyName">Название объекта</label>
                                        <input type="text" id="editPropertyName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPropertyAddress">Адрес</label>
                                        <input type="text" id="editPropertyAddress" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPropertyType">Тип объекта</label>
                                        <select id="editPropertyType" class="form-control" required>
                                            <option value="office">Офисное помещение</option>
                                            <option value="retail">Торговая площадь</option>
                                            <option value="warehouse">Складское помещение</option>
                                            <option value="industrial">Производственное помещение</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPropertyArea">Площадь (кв. м)</label>
                                        <input type="number" id="editPropertyArea" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPropertyStatus">Статус</label>
                                        <select id="editPropertyStatus" class="form-control" required>
                                            <option value="free">Свободен</option>
                                            <option value="occupied">Занят</option>
                                            <option value="maintenance">На обслуживании</option>
                                            <option value="reserved">Резерв</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="editPropertyPrice">Стоимость аренды (руб./мес.)</label>
                                        <input type="number" id="editPropertyPrice" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="editPropertyDescription">Описание</label>
                                    <textarea id="editPropertyDescription" class="form-control" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelEditProperty">Отмена</button>
                            <button class="btn btn-primary" id="saveEditProperty">Сохранить изменения</button>
                        </div>
                    </div>
                </div>

                <!-- Modal for editing tenant -->
                <div class="modal-overlay" id="editTenantModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">Редактировать арендатора</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="editTenantForm">
                                <input type="hidden" id="editTenantId">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="editTenantName">Название организации</label>
                                        <input type="text" id="editTenantName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTenantContact">Контактное лицо</label>
                                        <input type="text" id="editTenantContact" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTenantPhone">Телефон</label>
                                        <input type="tel" id="editTenantPhone" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTenantEmail">Email</label>
                                        <input type="email" id="editTenantEmail" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTenantINN">ИНН</label>
                                        <input type="text" id="editTenantINN" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTenantContract">Номер договора</label>
                                        <input type="text" id="editTenantContract" class="form-control" required>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelEditTenant">Отмена</button>
                            <button class="btn btn-primary" id="saveEditTenant">Сохранить изменения</button>
                        </div>
                    </div>
                </div>

                <!-- Modal for property details with tenant info -->
                <div class="modal-overlay" id="propertyDetailsModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title" id="propertyDetailsTitle">Информация об объекте</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="property-details">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Название объекта</label>
                                        <p id="detailPropertyName"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>Адрес</label>
                                        <p id="detailPropertyAddress"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>Тип объекта</label>
                                        <p id="detailPropertyType"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>Площадь</label>
                                        <p id="detailPropertyArea"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>Статус</label>
                                        <p id="detailPropertyStatus"></p>
                                    </div>
                                    <div class="form-group">
                                        <label>Стоимость аренды</label>
                                        <p id="detailPropertyPrice"></p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Описание</label>
                                    <p id="detailPropertyDescription"></p>
                                </div>
                            </div>

                            <div id="tenantInfoSection" style="display: none;">
                                <div class="tenant-info">
                                    <h3>Информация об арендаторе</h3>
                                    <div class="tenant-details">
                                        <div class="tenant-detail">
                                            <label>Организация</label>
                                            <span id="tenantInfoName"></span>
                                        </div>
                                        <div class="tenant-detail">
                                            <label>Контактное лицо</label>
                                            <span id="tenantInfoContact"></span>
                                        </div>
                                        <div class="tenant-detail">
                                            <label>Телефон</label>
                                            <span id="tenantInfoPhone"></span>
                                        </div>
                                        <div class="tenant-detail">
                                            <label>Email</label>
                                            <span id="tenantInfoEmail"></span>
                                        </div>
                                        <div class="tenant-detail">
                                            <label>ИНН</label>
                                            <span id="tenantInfoINN"></span>
                                        </div>
                                        <div class="tenant-detail">
                                            <label>Договор</label>
                                            <span id="tenantInfoContract"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="payment-history">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <h3>История оплат</h3>
                                        <button class="btn btn-sm btn-primary" id="addPaymentBtn">
                                            <i class="fas fa-plus"></i> Добавить оплату
                                        </button>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Период</th>
                                                    <th>Сумма</th>
                                                    <th>Дата оплаты</th>
                                                    <th>Статус</th>
                                                    <th>Действия</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentsTableBody">
                                                <!-- Payments will be added here dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div id="noTenantInfo" style="text-align: center; padding: 2rem; display: none;">
                                <i class="fas fa-users" style="font-size: 3rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <p>Объект свободен. Нет информации об арендаторе.</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="closePropertyDetails">Закрыть</button>
                        </div>
                    </div>
                </div>

                <!-- Modal for adding payment -->
                <div class="modal-overlay" id="addPaymentModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">Добавить оплату</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="addPaymentForm">
                                <input type="hidden" id="paymentPropertyId">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="paymentPeriod">Период оплаты</label>
                                        <input type="month" id="paymentPeriod" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentAmount">Сумма (руб.)</label>
                                        <input type="number" id="paymentAmount" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentDate">Дата оплаты</label>
                                        <input type="date" id="paymentDate" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentStatus">Статус</label>
                                        <select id="paymentStatus" class="form-control" required>
                                            <option value="paid">Оплачено</option>
                                            <option value="pending">Ожидание</option>
                                            <option value="overdue">Просрочено</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="paymentNotes">Примечания</label>
                                    <textarea id="paymentNotes" class="form-control" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelAddPayment">Отмена</button>
                            <button class="btn btn-primary" id="savePayment">Сохранить</button>
                        </div>
                    </div>
                </div>

                <!-- Modal for uploading document -->
                <div class="modal-overlay" id="uploadDocumentModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h3 class="modal-title">Загрузить документ</h3>
                            <button class="modal-close">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="uploadDocumentForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="documentName">Название документа</label>
                                        <input type="text" id="documentName" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="documentType">Тип документа</label>
                                        <select id="documentType" class="form-control" required>
                                            <option value="">Выберите тип</option>
                                            <option value="contract">Договор</option>
                                            <option value="technical">Техническая документация</option>
                                            <option value="act">Акт</option>
                                            <option value="cadastral">Кадастровый документ</option>
                                            <option value="report">Отчет</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="documentProperty">Объект недвижимости</label>
                                        <select id="documentProperty" class="form-control" required>
                                            <option value="">Выберите объект</option>
                                            <option value="1">БЦ "Высоцкий"</option>
                                            <option value="2">ТЦ "Солнечный"</option>
                                            <option value="3">Складской комплекс №3</option>
                                            <option value="4">Производственный цех №2</option>
                                            <option value="5">Земельный участок "Южный"</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="documentFile">Файл документа</label>
                                        <input type="file" id="documentFile" class="form-control" required>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelUploadDocument">Отмена</button>
                            <button class="btn btn-primary" id="saveUploadDocument">Загрузить</button>
                        </div>
                    </div>
                </div>

                <div class="notification" id="notification">
                    <span id="notificationText">Операция выполнена успешно!</span>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        // Initialize jsPDF
                        const { jsPDF } = window.jspdf;
                        
                        // Initialize map
                        let map = null;
                        
                        // Sample payment data
                        const samplePayments = {
                            "0": [ // БЦ "Высоцкий"
                                { period: "2023-05", amount: 250000, date: "2023-05-05", status: "paid" },
                                { period: "2023-04", amount: 250000, date: "2023-04-03", status: "paid" },
                                { period: "2023-03", amount: 250000, date: "2023-03-05", status: "paid" },
                                { period: "2023-02", amount: 250000, date: "2023-02-06", status: "paid" }
                            ],
                            "2": [ // Складской комплекс №3
                                { period: "2023-05", amount: 750000, date: "2023-05-10", status: "paid" },
                                { period: "2023-04", amount: 750000, date: "2023-04-12", status: "paid" },
                                { period: "2023-03", amount: 750000, date: "2023-03-08", status: "paid" },
                                { period: "2023-02", amount: 750000, date: "2023-02-07", status: "paid" }
                            ]
                        };
                        
                        // Show notification function
                        function showNotification(message, isError = false) {
                            const notification = document.getElementById('notification');
                            const notificationText = document.getElementById('notificationText');
                            
                            notificationText.textContent = message;
                            
                            if (isError) {
                                notification.classList.add('error');
                            } else {
                                notification.classList.remove('error');
                            }
                            
                            notification.classList.add('show');
                            
                            setTimeout(() => {
                                notification.classList.remove('show');
                            }, 3000);
                        }
                        
                        // Navigation
                        const navLinks = document.querySelectorAll('.nav-link');
                        const pages = document.querySelectorAll('.page');
                        
                        navLinks.forEach(link => {
                            link.addEventListener('click', function(e) {
                                e.preventDefault();
                                const targetPage = this.getAttribute('data-page');
                                
                                // Update active nav link
                                navLinks.forEach(navLink => navLink.classList.remove('active'));
                                this.classList.add('active');
                                
                                // Show target page
                                pages.forEach(page => {
                                    page.classList.remove('active');
                                    if (page.id === targetPage) {
                                        page.classList.add('active');
                                        document.querySelector('.page-title').textContent = this.querySelector('i').parentNode.textContent.trim();
                                        
                                        // Initialize map if we're on the map page
                                        if (page.id === 'map' && !map) {
                                            initMap();
                                        }
                                    }
                                });
                            });
                        });
                        
                        // Initialize map function
                        function initMap() {
                            // Center on Krasnodar Krai
                            map = L.map('map-container').setView([45.035, 38.975], 8);
                            
                            // Add OpenStreetMap tiles
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                            }).addTo(map);
                            
                            // Add sample property markers
                            const properties = [
                                {name: 'БЦ "Высоцкий"', lat: 45.016, lng: 38.974, status: 'occupied'},
                                {name: 'ТЦ "Солнечный"', lat: 45.023, lng: 39.031, status: 'free'},
                                {name: 'Складской комплекс №3', lat: 45.102, lng: 38.942, status: 'occupied'},
                                {name: 'Производственный цех №2', lat: 45.058, lng: 38.875, status: 'maintenance'},
                                {name: 'Земельный участок "Южный"', lat: 44.958, lng: 38.998, status: 'free'}
                            ];
                            
                            properties.forEach(property => {
                                let markerColor;
                                switch(property.status) {
                                    case 'free': markerColor = '#4cc9a4'; break;
                                    case 'occupied': markerColor = '#ef476f'; break;
                                    case 'maintenance': markerColor = '#ffd166'; break;
                                }
                                
                                const marker = L.marker([property.lat, property.lng], {
                                    icon: L.divIcon({
                                        className: 'property-marker',
                                        html: `<div style="background-color: ${markerColor}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>`,
                                        iconSize: [24, 24],
                                        iconAnchor: [12, 12]
                                    })
                                }).addTo(map);
                                
                                marker.bindPopup(`
                                    <div style="font-weight: bold; margin-bottom: 8px;">${property.name}</div>
                                    <div>Статус: <span style="color: ${markerColor}; font-weight: 500;">${
                                        property.status === 'free' ? 'Свободен' : 
                                        property.status === 'occupied' ? 'Арендован' : 'На обслуживании'
                                    }</span></div>
                                    <div style="margin-top: 8px;">
                                        <a href="#" style="color: #4361ee; text-decoration: none;">Подробнее →</a>
                                    </div>
                                `);
                            });
                            
                            showNotification('Карта объектов успешно загружена');
                        }
                        
                        // Theme toggle
                        const themeToggle = document.getElementById('themeToggle');
                        themeToggle.addEventListener('click', function() {
                            document.body.classList.toggle('dark-mode');
                            const isDarkMode = document.body.classList.contains('dark-mode');
                            showNotification(isDarkMode ? 'Темный режим включен' : 'Темный режим выключен');
                        });
                        
                        // Menu toggle for mobile
                        const menuToggle = document.getElementById('menuToggle');
                        menuToggle.addEventListener('click', function() {
                            document.querySelector('.sidebar').classList.toggle('active');
                        });
                        
                        // Property form handling
                        const propertyForm = document.getElementById('propertyForm');
                        const propertiesTableBody = document.getElementById('propertiesTableBody');
                        
                        // Load properties from localStorage
                        function loadProperties() {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            propertiesTableBody.innerHTML = '';
                            
                            if (properties.length === 0) {
                                propertiesTableBody.innerHTML = `
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 2rem; color: var(--secondary);">
                                            <i class="fas fa-building" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                            Нет добавленных объектов. Добавьте первый объект используя форму выше.
                                        </td>
                                    </tr>
                                `;
                                return;
                            }
                            
                            properties.forEach((property, index) => {
                                const row = document.createElement('tr');
                                
                                // Determine status badge class
                                let statusClass = '';
                                let statusText = '';
                                
                                switch(property.status) {
                                    case 'free':
                                        statusClass = 'status-free';
                                        statusText = 'Свободен';
                                        break;
                                    case 'occupied':
                                        statusClass = 'status-occupied';
                                        statusText = 'Занят';
                                        break;
                                    case 'maintenance':
                                        statusClass = 'status-maintenance';
                                        statusText = 'Обслуживание';
                                        break;
                                    case 'reserved':
                                        statusClass = 'status-free';
                                        statusText = 'Резерв';
                                        break;
                                }
                                
                                // Determine type text
                                let typeText = '';
                                switch(property.type) {
                                    case 'office':
                                        typeText = 'Офис';
                                        break;
                                    case 'retail':
                                        typeText = 'Торговая';
                                        break;
                                    case 'warehouse':
                                        typeText = 'Склад';
                                        break;
                                    case 'industrial':
                                        typeText = 'Производство';
                                        break;
                                }
                                
                                row.innerHTML = `
                                    <td>${property.name}</td>
                                    <td>${property.address}</td>
                                    <td>${typeText}</td>
                                    <td>${property.area} кв.м</td>
                                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                    <td>${Number(property.price).toLocaleString('ru-RU')} руб.</td>
                                    <td class="action-buttons">
                                        <i class="fas fa-eye action-btn view-property" data-index="${index}" title="Просмотр"></i>
                                        <i class="fas fa-edit action-btn edit-property" data-index="${index}" title="Редактировать"></i>
                                        <i class="fas fa-trash action-btn delete-property" data-index="${index}" title="Удалить"></i>
                                        <i class="fas fa-file-excel action-btn export-property" data-index="${index}" title="Экспорт в Excel"></i>
                                    </td>
                                `;
                                
                                propertiesTableBody.appendChild(row);
                            });
                            
                            // Add event listeners to action buttons
                            document.querySelectorAll('.view-property').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    showPropertyDetails(index);
                                });
                            });
                            
                            document.querySelectorAll('.edit-property').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    editProperty(index);
                                });
                            });
                            
                            document.querySelectorAll('.delete-property').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    deleteProperty(index);
                                });
                            });
                            
                            document.querySelectorAll('.export-property').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    exportPropertyToExcel(index);
                                });
                            });
                        }
                        
                        // Show property details with tenant info
                        function showPropertyDetails(index) {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            const property = properties[index];
                            
                            // Fill property details
                            document.getElementById('propertyDetailsTitle').textContent = property.name;
                            document.getElementById('detailPropertyName').textContent = property.name;
                            document.getElementById('detailPropertyAddress').textContent = property.address;
                            
                            // Determine type text
                            let typeText = '';
                            switch(property.type) {
                                case 'office':
                                    typeText = 'Офисное помещение';
                                    break;
                                case 'retail':
                                    typeText = 'Торговая площадь';
                                    break;
                                case 'warehouse':
                                    typeText = 'Складское помещение';
                                    break;
                                case 'industrial':
                                    typeText = 'Производственное помещение';
                                    break;
                            }
                            document.getElementById('detailPropertyType').textContent = typeText;
                            
                            document.getElementById('detailPropertyArea').textContent = `${property.area} кв.м`;
                            
                            // Determine status text
                            let statusText = '';
                            switch(property.status) {
                                case 'free':
                                    statusText = 'Свободен';
                                    break;
                                case 'occupied':
                                    statusText = 'Занят';
                                    break;
                                case 'maintenance':
                                    statusText = 'На обслуживании';
                                    break;
                                case 'reserved':
                                    statusText = 'Резерв';
                                    break;
                            }
                            document.getElementById('detailPropertyStatus').textContent = statusText;
                            
                            document.getElementById('detailPropertyPrice').textContent = `${Number(property.price).toLocaleString('ru-RU')} руб./мес.`;
                            document.getElementById('detailPropertyDescription').textContent = property.description || '—';
                            
                            // Show tenant info if property is occupied
                            if (property.status === 'occupied') {
                                const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                                // For demo purposes, use the first tenant if available
                                if (tenants.length > 0) {
                                    const tenant = tenants[0]; // In real app, this would be linked to the property
                                    
                                    document.getElementById('tenantInfoName').textContent = tenant.name;
                                    document.getElementById('tenantInfoContact').textContent = tenant.contact;
                                    document.getElementById('tenantInfoPhone').textContent = tenant.phone;
                                    document.getElementById('tenantInfoEmail').textContent = tenant.email;
                                    document.getElementById('tenantInfoINN').textContent = tenant.inn;
                                    document.getElementById('tenantInfoContract').textContent = tenant.contract;
                                    
                                    document.getElementById('tenantInfoSection').style.display = 'block';
                                    document.getElementById('noTenantInfo').style.display = 'none';
                                    
                                    // Load payment history
                                    loadPaymentHistory(index);
                                } else {
                                    document.getElementById('tenantInfoSection').style.display = 'none';
                                    document.getElementById('noTenantInfo').style.display = 'block';
                                }
                            } else {
                                document.getElementById('tenantInfoSection').style.display = 'none';
                                document.getElementById('noTenantInfo').style.display = 'block';
                            }
                            
                            // Store the property index for adding payments
                            document.getElementById('paymentPropertyId').value = index;
                            
                            // Show the modal
                            document.getElementById('propertyDetailsModal').classList.add('active');
                        }
                        
                        // Load payment history for a property
                        function loadPaymentHistory(propertyIndex) {
                            const paymentsTableBody = document.getElementById('paymentsTableBody');
                            paymentsTableBody.innerHTML = '';
                            
                            // Get payments for this property (from sample data or localStorage)
                            const payments = samplePayments[propertyIndex] || [];
                            
                            if (payments.length === 0) {
                                paymentsTableBody.innerHTML = `
                                    <tr>
                                        <td colspan="5" style="text-align: center; padding: 1.5rem; color: var(--secondary);">
                                            <i class="fas fa-receipt" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                                            Нет данных об оплатах
                                        </td>
                                    </tr>
                                `;
                                return;
                            }
                            
                            payments.forEach((payment, index) => {
                                const row = document.createElement('tr');
                                
                                // Format period (YYYY-MM to Month YYYY)
                                const [year, month] = payment.period.split('-');
                                const periodText = new Date(year, month - 1).toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });
                                
                                // Format date
                                const paymentDate = new Date(payment.date).toLocaleDateString('ru-RU');
                                
                                // Determine status class and text
                                let statusClass = '';
                                let statusText = '';
                                
                                switch(payment.status) {
                                    case 'paid':
                                        statusClass = 'payment-status-paid';
                                        statusText = 'Оплачено';
                                        break;
                                    case 'pending':
                                        statusClass = 'payment-status-pending';
                                        statusText = 'Ожидание';
                                        break;
                                    case 'overdue':
                                        statusClass = 'payment-status-overdue';
                                        statusText = 'Просрочено';
                                        break;
                                }
                                
                                row.innerHTML = `
                                    <td>${periodText}</td>
                                    <td>${Number(payment.amount).toLocaleString('ru-RU')} руб.</td>
                                    <td>${paymentDate}</td>
                                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                                    <td class="action-buttons">
                                        <i class="fas fa-receipt action-btn view-payment" data-index="${index}" title="Детали оплаты"></i>
                                        <i class="fas fa-file-pdf action-btn export-payment" data-index="${index}" title="Экспорт квитанции"></i>
                                    </td>
                                `;
                                
                                paymentsTableBody.appendChild(row);
                            });
                            
                            // Add event listeners to payment action buttons
                            document.querySelectorAll('.view-payment').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const paymentIndex = this.getAttribute('data-index');
                                    const propertyIndex = document.getElementById('paymentPropertyId').value;
                                    viewPaymentDetails(propertyIndex, paymentIndex);
                                });
                            });
                            
                            document.querySelectorAll('.export-payment').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const paymentIndex = this.getAttribute('data-index');
                                    const propertyIndex = document.getElementById('paymentPropertyId').value;
                                    exportPaymentReceipt(propertyIndex, paymentIndex);
                                });
                            });
                        }
                        
                        // View payment details
                        function viewPaymentDetails(propertyIndex, paymentIndex) {
                            const payments = samplePayments[propertyIndex] || [];
                            const payment = payments[paymentIndex];
                            
                            if (payment) {
                                const [year, month] = payment.period.split('-');
                                const periodText = new Date(year, month - 1).toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });
                                const paymentDate = new Date(payment.date).toLocaleDateString('ru-RU');
                                
                                alert(`Детали оплаты:\n\nПериод: ${periodText}\nСумма: ${Number(payment.amount).toLocaleString('ru-RU')} руб.\nДата оплаты: ${paymentDate}\nСтатус: ${payment.status}`);
                            }
                        }
                        
                        // Export payment receipt
                        function exportPaymentReceipt(propertyIndex, paymentIndex) {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            const property = properties[propertyIndex];
                            const payments = samplePayments[propertyIndex] || [];
                            const payment = payments[paymentIndex];
                            
                            if (property && payment) {
                                showNotification('Квитанция успешно экспортирована в PDF!');
                            }
                        }
                        
                        // Add new property
                        propertyForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const property = {
                                name: document.getElementById('propertyName').value,
                                address: document.getElementById('propertyAddress').value,
                                type: document.getElementById('propertyType').value,
                                area: document.getElementById('propertyArea').value,
                                status: document.getElementById('propertyStatus').value,
                                price: document.getElementById('propertyPrice').value,
                                description: document.getElementById('propertyDescription').value
                            };
                            
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            properties.push(property);
                            localStorage.setItem('properties', JSON.stringify(properties));
                            
                            loadProperties();
                            propertyForm.reset();
                            
                            showNotification('Объект успешно добавлен!');
                        });
                        
                        // Edit property
                        function editProperty(index) {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            const property = properties[index];
                            
                            document.getElementById('editPropertyId').value = index;
                            document.getElementById('editPropertyName').value = property.name;
                            document.getElementById('editPropertyAddress').value = property.address;
                            document.getElementById('editPropertyType').value = property.type;
                            document.getElementById('editPropertyArea').value = property.area;
                            document.getElementById('editPropertyStatus').value = property.status;
                            document.getElementById('editPropertyPrice').value = property.price;
                            document.getElementById('editPropertyDescription').value = property.description || '';
                            
                            document.getElementById('editPropertyModal').classList.add('active');
                        }
                        
                        // Save edited property
                        document.getElementById('saveEditProperty').addEventListener('click', function() {
                            const index = document.getElementById('editPropertyId').value;
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            
                            properties[index] = {
                                name: document.getElementById('editPropertyName').value,
                                address: document.getElementById('editPropertyAddress').value,
                                type: document.getElementById('editPropertyType').value,
                                area: document.getElementById('editPropertyArea').value,
                                status: document.getElementById('editPropertyStatus').value,
                                price: document.getElementById('editPropertyPrice').value,
                                description: document.getElementById('editPropertyDescription').value
                            };
                            
                            localStorage.setItem('properties', JSON.stringify(properties));
                            loadProperties();
                            
                            document.getElementById('editPropertyModal').classList.remove('active');
                            showNotification('Изменения сохранены!');
                        });
                        
                        // Delete property
                        function deleteProperty(index) {
                            if (confirm('Вы уверены, что хотите удалить этот объект?')) {
                                const properties = JSON.parse(localStorage.getItem('properties')) || [];
                                properties.splice(index, 1);
                                localStorage.setItem('properties', JSON.stringify(properties));
                                loadProperties();
                                showNotification('Объект удален!');
                            }
                        }
                        
                        // Tenant form handling
                        const tenantForm = document.getElementById('tenantForm');
                        const tenantsTableBody = document.getElementById('tenantsTableBody');
                        
                        // Load tenants from localStorage
                        function loadTenants() {
                            const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                            tenantsTableBody.innerHTML = '';
                            
                            if (tenants.length === 0) {
                                tenantsTableBody.innerHTML = `
                                    <tr>
                                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--secondary);">
                                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                                            Нет добавленных арендаторов. Добавьте первого арендатора используя форму выше.
                                        </td>
                                    </tr>
                                `;
                                return;
                            }
                            
                            tenants.forEach((tenant, index) => {
                                const row = document.createElement('tr');
                                
                                row.innerHTML = `
                                    <td>${tenant.name}</td>
                                    <td>${tenant.contact}</td>
                                    <td>${tenant.phone}</td>
                                    <td>${tenant.email}</td>
                                    <td>${tenant.contract}</td>
                                    <td class="action-buttons">
                                        <i class="fas fa-edit action-btn edit-tenant" data-index="${index}" title="Редактировать"></i>
                                        <i class="fas fa-trash action-btn delete-tenant" data-index="${index}" title="Удалить"></i>
                                    </td>
                                `;
                                
                                tenantsTableBody.appendChild(row);
                            });
                            
                            // Add event listeners to edit and delete buttons
                            document.querySelectorAll('.edit-tenant').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    editTenant(index);
                                });
                            });
                            
                            document.querySelectorAll('.delete-tenant').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    const index = this.getAttribute('data-index');
                                    deleteTenant(index);
                                });
                            });
                        }
                        
                        // Add new tenant
                        tenantForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const tenant = {
                                name: document.getElementById('tenantName').value,
                                contact: document.getElementById('tenantContact').value,
                                phone: document.getElementById('tenantPhone').value,
                                email: document.getElementById('tenantEmail').value,
                                inn: document.getElementById('tenantINN').value,
                                contract: document.getElementById('tenantContract').value
                            };
                            
                            const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                            tenants.push(tenant);
                            localStorage.setItem('tenants', JSON.stringify(tenants));
                            
                            loadTenants();
                            tenantForm.reset();
                            
                            showNotification('Арендатор успешно добавлен!');
                        });
                        
                        // Edit tenant
                        function editTenant(index) {
                            const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                            const tenant = tenants[index];
                            
                            document.getElementById('editTenantId').value = index;
                            document.getElementById('editTenantName').value = tenant.name;
                            document.getElementById('editTenantContact').value = tenant.contact;
                            document.getElementById('editTenantPhone').value = tenant.phone;
                            document.getElementById('editTenantEmail').value = tenant.email;
                            document.getElementById('editTenantINN').value = tenant.inn;
                            document.getElementById('editTenantContract').value = tenant.contract;
                            
                            document.getElementById('editTenantModal').classList.add('active');
                        }
                        
                        // Save edited tenant
                        document.getElementById('saveEditTenant').addEventListener('click', function() {
                            const index = document.getElementById('editTenantId').value;
                            const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                            
                            tenants[index] = {
                                name: document.getElementById('editTenantName').value,
                                contact: document.getElementById('editTenantContact').value,
                                phone: document.getElementById('editTenantPhone').value,
                                email: document.getElementById('editTenantEmail').value,
                                inn: document.getElementById('editTenantINN').value,
                                contract: document.getElementById('editTenantContract').value
                            };
                            
                            localStorage.setItem('tenants', JSON.stringify(tenants));
                            loadTenants();
                            
                            document.getElementById('editTenantModal').classList.remove('active');
                            showNotification('Изменения сохранены!');
                        });
                        
                        // Delete tenant
                        function deleteTenant(index) {
                            if (confirm('Вы уверены, что хотите удалить этого арендатора?')) {
                                const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
                                tenants.splice(index, 1);
                                localStorage.setItem('tenants', JSON.stringify(tenants));
                                loadTenants();
                                showNotification('Арендатор удален!');
                            }
                        }
                        
                        // Add payment button
                        document.getElementById('addPaymentBtn').addEventListener('click', function() {
                            document.getElementById('addPaymentModal').classList.add('active');
                            
                            // Set default values
                            const now = new Date();
                            const year = now.getFullYear();
                            const month = String(now.getMonth() + 1).padStart(2, '0');
                            document.getElementById('paymentPeriod').value = `${year}-${month}`;
                            document.getElementById('paymentDate').valueAsDate = now;
                            
                            // Set amount from property price
                            const propertyIndex = document.getElementById('paymentPropertyId').value;
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            if (properties[propertyIndex]) {
                                document.getElementById('paymentAmount').value = properties[propertyIndex].price;
                            }
                        });
                        
                        // Save payment
                        document.getElementById('savePayment').addEventListener('click', function() {
                            const propertyIndex = document.getElementById('paymentPropertyId').value;
                            const period = document.getElementById('paymentPeriod').value;
                            const amount = document.getElementById('paymentAmount').value;
                            const date = document.getElementById('paymentDate').value;
                            const status = document.getElementById('paymentStatus').value;
                            const notes = document.getElementById('paymentNotes').value;
                            
                            // In a real app, this would save to a database
                            // For this demo, we'll just show a notification
                            
                            document.getElementById('addPaymentModal').classList.remove('active');
                            document.getElementById('addPaymentForm').reset();
                            
                            showNotification('Оплата успешно добавлена!');
                            
                            // Reload payment history
                            loadPaymentHistory(propertyIndex);
                        });
                        
                        // Modal close handlers
                        document.querySelectorAll('.modal-close, .modal-overlay, #cancelEditProperty, #cancelEditTenant, #cancelUploadDocument, #cancelAddPayment, #closePropertyDetails').forEach(element => {
                            element.addEventListener('click', function() {
                                document.querySelectorAll('.modal-overlay').forEach(modal => {
                                    modal.classList.remove('active');
                                });
                            });
                        });
                        
                        // Stop propagation for modal content clicks
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.addEventListener('click', function(e) {
                                e.stopPropagation();
                            });
                        });
                        
                        // Export property to Excel
                        function exportPropertyToExcel(index) {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            const property = properties[index];
                            
                            // Create workbook and worksheet
                            const workbook = new ExcelJS.Workbook();
                            const worksheet = workbook.addWorksheet('Карточка объекта');
                            
                            // Add title
                            worksheet.mergeCells('A1:B1');
                            worksheet.getCell('A1').value = 'Наша недвижимость';
                            worksheet.getCell('A1').font = { bold: true, size: 16 };
                            worksheet.getCell('A1').alignment = { horizontal: 'center' };
                            
                            worksheet.mergeCells('A2:B2');
                            worksheet.getCell('A2').value = 'Карточка объекта недвижимости';
                            worksheet.getCell('A2').font = { bold: true, size: 14 };
                            worksheet.getCell('A2').alignment = { horizontal: 'center' };
                            
                            // Add property details
                            worksheet.addRow(['Название:', property.name]);
                            worksheet.addRow(['Адрес:', property.address]);
                            
                            // Determine type text
                            let typeText = '';
                            switch(property.type) {
                                case 'office':
                                    typeText = 'Офисное помещение';
                                    break;
                                case 'retail':
                                    typeText = 'Торговая площадь';
                                    break;
                                case 'warehouse':
                                    typeText = 'Складское помещение';
                                    break;
                                case 'industrial':
                                    typeText = 'Производственное помещение';
                                    break;
                            }
                            
                            worksheet.addRow(['Тип объекта:', typeText]);
                            worksheet.addRow(['Площадь:', `${property.area} кв.м`]);
                            
                            // Determine status text
                            let statusText = '';
                            switch(property.status) {
                                case 'free':
                                    statusText = 'Свободен';
                                    break;
                                case 'occupied':
                                    statusText = 'Занят';
                                    break;
                                case 'maintenance':
                                    statusText = 'На обслуживании';
                                    break;
                                case 'reserved':
                                    statusText = 'Резерв';
                                    break;
                            }
                            
                            worksheet.addRow(['Статус:', statusText]);
                            worksheet.addRow(['Стоимость аренды:', `${Number(property.price).toLocaleString('ru-RU')} руб./мес.`]);
                            
                            if (property.description) {
                                worksheet.addRow(['Описание:', property.description]);
                            }
                            
                            // Add generated date
                            const generatedDate = new Date().toLocaleDateString('ru-RU');
                            worksheet.addRow(['Сгенерировано:', generatedDate]);
                            
                            // Format columns
                            worksheet.columns = [
                                { width: 25 },
                                { width: 40 }
                            ];
                            
                            // Format header cells
                            for (let i = 1; i <= 3; i++) {
                                worksheet.getRow(i).font = { bold: true };
                            }
                            
                            // Save workbook
                            workbook.xlsx.writeBuffer().then(function(buffer) {
                                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                                saveAs(blob, `Карточка объекта - ${property.name}.xlsx`);
                                showNotification('Файл успешно экспортирован в Excel!');
                            }).catch(function(error) {
                                showNotification('Ошибка при экспорте файла', true);
                                console.error('Excel export error:', error);
                            });
                        }
                        
                        // Export properties to Excel
                        document.getElementById('exportPropertiesExcel').addEventListener('click', function() {
                            const properties = JSON.parse(localStorage.getItem('properties')) || [];
                            
                            if (properties.length === 0) {
                                showNotification('Нет объектов для экспорта', true);
                                return;
                            }
                            
                            // Create workbook and worksheet
                            const workbook = new ExcelJS.Workbook();
                            const worksheet = workbook.addWorksheet('Объекты недвижимости');
                            
                            // Add header row
                            worksheet.addRow(['Название', 'Адрес', 'Тип', 'Площадь (кв.м)', 'Статус', 'Стоимость аренды (руб./мес.)']);
                            
                            // Format header row
                            worksheet.getRow(1).font = { bold: true };
                            worksheet.getRow(1).fill = {
                                type: 'pattern',
                                pattern: 'solid',
                                fgColor: { argb: 'FF4361EE' }
                            };
                            worksheet.getRow(1).font = { color: { argb: 'FFFFFFFF' }, bold: true };
                            
                            // Add data rows
                            properties.forEach(property => {
                                // Determine type text
                                let typeText = '';
                                switch(property.type) {
                                    case 'office':
                                        typeText = 'Офис';
                                        break;
                                    case 'retail':
                                        typeText = 'Торговая';
                                        break;
                                    case 'warehouse':
                                        typeText = 'Склад';
                                        break;
                                    case 'industrial':
                                        typeText = 'Производство';
                                        break;
                                }
                                
                                // Determine status text
                                let statusText = '';
                                switch(property.status) {
                                    case 'free':
                                        statusText = 'Свободен';
                                        break;
                                    case 'occupied':
                                        statusText = 'Занят';
                                        break;
                                    case 'maintenance':
                                        statusText = 'Обслуживание';
                                        break;
                                    case 'reserved':
                                        statusText = 'Резерв';
                                        break;
                                }
                                
                                worksheet.addRow([
                                    property.name,
                                    property.address,
                                    typeText,
                                    property.area,
                                    statusText,
                                    property.price
                                ]);
                            });
                            
                            // Format columns
                            worksheet.columns = [
                                { width: 30 }, // Название
                                { width: 40 }, // Адрес
                                { width: 15 }, // Тип
                                { width: 15 }, // Площадь
                                { width: 15 }, // Статус
                                { width: 25 }  // Стоимость
                            ];
                            
                            // Format currency column
                            worksheet.getColumn(6).numFmt = '#,##0.00" руб."';
                            
                            // Save workbook
                            workbook.xlsx.writeBuffer().then(function(buffer) {
                                const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                                saveAs(blob, 'Объекты недвижимости.xlsx');
                                showNotification('Файл успешно экспортирован в Excel!');
                            }).catch(function(error) {
                                showNotification('Ошибка при экспорте файла', true);
                                console.error('Excel export error:', error);
                            });
                        });
                        
                        // Export dashboard to PDF
                        document.getElementById('exportDashboardPdf').addEventListener('click', function() {
                            const doc = new jsPDF();
                            
                            // Add logo and title
                            doc.setFillColor(67, 97, 238);
                            doc.rect(0, 0, 220, 30, 'F');
                            doc.setFontSize(22);
                            doc.setTextColor(255, 255, 255);
                            doc.text('Наша недвижимость', 105, 17, { align: 'center' });
                            
                            // Add report title
                            doc.setFontSize(16);
                            doc.setTextColor(0, 0, 0);
                            doc.text('Дашборд - Обзор состояния недвижимости', 105, 45, { align: 'center' });
                            
                            // Add stats
                            doc.setFontSize(14);
                            doc.setTextColor(67, 97, 238);
                            doc.text('Ключевые показатели', 20, 60);
                            
                            doc.setFontSize(12);
                            doc.setTextColor(0, 0, 0);
                            doc.text('• Всего объектов: 154', 20, 70);
                            doc.text('• Свободно: 42 (27.3%)', 20, 80);
                            doc.text('• Арендовано: 87 (56.5%)', 20, 90);
                            doc.text('• На обслуживании: 25 (16.2%)', 20, 100);
                            
                            doc.setTextColor(67, 97, 238);
                            doc.text('Финансовые показатели', 20, 120);
                            
                            doc.setTextColor(0, 0, 0);
                            doc.text('• Общая месячная выручка: 5 842 500 руб.', 20, 130);
                            doc.text('• Средняя доходность на кв.м: 1 250 руб./мес.', 20, 140);
                            doc.text('• Затраты на содержание: 1 235 600 руб.', 20, 150);
                            doc.text('• Чистая прибыль: 4 606 900 руб.', 20, 160);
                            
                            // Add generated date
                            const generatedDate = new Date().toLocaleDateString('ru-RU');
                            doc.setFontSize(10);
                            doc.setTextColor(100, 100, 100);
                            doc.text(`Сгенерировано: ${generatedDate}`, 105, 280, { align: 'center' });
                            
                            // Save the PDF
                            doc.save('Дашборд - Обзор состояния недвижимости.pdf');
                            showNotification('Отчет успешно экспортирован в PDF!');
                        });
                        
                        // Upload document button
                        document.getElementById('uploadDocumentBtn').addEventListener('click', function() {
                            document.getElementById('uploadDocumentModal').classList.add('active');
                        });
                        
                        // Save uploaded document
                        document.getElementById('saveUploadDocument').addEventListener('click', function() {
                            const documentName = document.getElementById('documentName').value;
                            const documentType = document.getElementById('documentType').value;
                            const documentProperty = document.getElementById('documentProperty').value;
                            const documentFile = document.getElementById('documentFile').files[0];
                            
                            if (documentName && documentType && documentProperty && documentFile) {
                                showNotification(`Документ "${documentName}" успешно загружен!`);
                                document.getElementById('uploadDocumentForm').reset();
                                document.getElementById('uploadDocumentModal').classList.remove('active');
                            } else {
                                showNotification('Пожалуйста, заполните все поля и выберите файл!', true);
                            }
                        });
                        
                        // Search documents button
                        document.getElementById('searchDocumentsBtn').addEventListener('click', function() {
                            const searchTerm = prompt('Введите поисковый запрос:');
                            if (searchTerm) {
                                showNotification(`Поиск документов по запросу: "${searchTerm}"`);
                            }
                        });
                        
                        // View document buttons
                        document.querySelectorAll('.view-document').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const docId = this.getAttribute('data-id');
                                showNotification(`Просмотр документа с ID: ${docId}`);
                            });
                        });
                        
                        // Download document buttons
                        document.querySelectorAll('.download-document').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const docId = this.getAttribute('data-id');
                                showNotification(`Скачивание документа с ID: ${docId}`);
                            });
                        });
                        
                        // View contract buttons
                        document.querySelectorAll('.view-contract').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const contractId = this.getAttribute('data-id');
                                showNotification(`Просмотр договора с ID: ${contractId}`);
                            });
                        });
                        
                        // Edit contract buttons
                        document.querySelectorAll('.edit-contract').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const contractId = this.getAttribute('data-id');
                                showNotification(`Редактирование договора с ID: ${contractId}`);
                            });
                        });
                        
                        // Export contract buttons
                        document.querySelectorAll('.export-contract').forEach(btn => {
                            btn.addEventListener('click', function() {
                                const contractId = this.getAttribute('data-id');
                                showNotification(`Экспорт договора с ID: ${contractId} в Excel`);
                            });
                        });
                        
                        // Add contract button
                        document.getElementById('addContractBtn').addEventListener('click', function() {
                            showNotification('Добавление нового договора');
                        });
                        
                        // Export contracts button
                        document.getElementById('exportContractsPdf').addEventListener('click', function() {
                            showNotification('Экспорт списка договоров в PDF');
                        });
                        
                        // Save settings button
                        document.getElementById('saveSettings').addEventListener('click', function() {
                            showNotification('Настройки успешно сохранены!');
                        });
                        
                        // Initialize data
                        loadProperties();
                        loadTenants();
                        
                        // Add sample data if empty
                        if (JSON.parse(localStorage.getItem('properties')) === null || JSON.parse(localStorage.getItem('properties')).length === 0) {
                            const sampleProperties = [
                                {
                                    name: 'БЦ "Высоцкий"',
                                    address: 'ул. Примерная, 15',
                                    type: 'office',
                                    area: 350,
                                    status: 'occupied',
                                    price: 250000,
                                    description: 'Премиум бизнес-центр в центре города'
                                },
                                {
                                    name: 'ТЦ "Солнечный"',
                                    address: 'пр. Мира, 42',
                                    type: 'retail',
                                    area: 1200,
                                    status: 'free',
                                    price: 1800000,
                                    description: 'Торговый центр с высокой проходимостью'
                                },
                                {
                                    name: 'Складской комплекс №3',
                                    address: 'промзона, стр. 5',
                                    type: 'warehouse',
                                    area: 2500,
                                    status: 'occupied',
                                    price: 750000,
                                    description: 'Современный складской комплекс с подъездными путями'
                                },
                                {
                                    name: 'Производственный цех №2',
                                    address: 'ул. Заводская, 8',
                                    type: 'industrial',
                                    area: 1800,
                                    status: 'maintenance',
                                    price: 500000,
                                    description: 'Производственное помещение с кран-балкой'
                                }
                            ];
                            localStorage.setItem('properties', JSON.stringify(sampleProperties));
                            loadProperties();
                        }
                        
                        if (JSON.parse(localStorage.getItem('tenants')) === null || JSON.parse(localStorage.getItem('tenants')).length === 0) {
                            const sampleTenants = [
                                {
                                    name: 'ООО "ТехноПром"',
                                    contact: 'Иванов П.С.',
                                    phone: '+7 (495) 123-45-67',
                                    email: 'info@technoprom.ru',
                                    inn: '7734567890',
                                    contract: 'А-2023-0451'
                                },
                                {
                                    name: 'ЗАО "Вектор"',
                                    contact: 'Петрова А.И.',
                                    phone: '+7 (495) 987-65-43',
                                    email: 'rent@vector.ru',
                                    inn: '7701987654',
                                    contract: 'А-2023-0789'
                                },
                                {
                                    name: 'ИП Смирнов А.В.',
                                    contact: 'Смирнов А.В.',
                                    phone: '+7 (495) 555-35-35',
                                    email: 'smirnov@logistics.ru',
                                    inn: '7712345678',
                                    contract: 'А-2022-1256'
                                }
                            ];
                            localStorage.setItem('tenants', JSON.stringify(sampleTenants));
                            loadTenants();
                        }
                    });
                </script>
            </body>
            </html>
